<DataListSpec 
	xmlns="bb_appfx_datalist"
	xmlns:common="bb_appfx_commontypes"
	ID="7aa495fb-d5a1-406b-b581-2900a33fab0c" 
	Name="HFHI CRM MODELSCOREATTRIBUTES CURRENT Data List"
	Description="A data list showing hfhi crm modelscoreattributes current records." 
	Author="HFHCON-DEV\twillis"
	>


	<SPDataList SPName="USR_USP_DATALIST_HFHI_CRM_MODELSCOREATTRIBUTES_CURRENT">
		<CreateProcedureSQL xmlns="bb_appfx_commontypes">
			<![CDATA[
CREATE PROCEDURE dbo.USR_USP_DATALIST_HFHI_CRM_MODELSCOREATTRIBUTES_CURRENT
(
    @CONSTITUENTID uniqueidentifier
)
AS
BEGIN
    SET NOCOUNT ON;

    ;WITH RankedScores AS (
        SELECT
            s.ID,
            s.NAME AS ModelScoreType,
            s.SCORE AS [Value],
            s.UPDATEDON AS StartDate,
            NULL AS EndDate,   -- placeholder for dynamic end-dating logic
            ROW_NUMBER() OVER (
                PARTITION BY s.ANALYTICSMODELID
                ORDER BY s.UPDATEDON DESC
            ) AS RN
        FROM dbo.UFN_MODELSCORESFORCONSTITUENT(@CONSTITUENTID) s
    )
    SELECT 
        ModelScoreType,
        [Value],
        StartDate,
        EndDate
    FROM RankedScores
    WHERE RN = 1   -- keep only the most recent score per model
    ORDER BY ModelScoreType;
END
            ]]>
		</CreateProcedureSQL>
	</SPDataList>

	<Context ContextRecordType="Constituent" RecordIDParameter="CONSTITUENTID" />

	<Output>
		<OutputFields>
			<OutputField FieldID="ModelScoreType" Caption="Model Score Type" DataType="String" />
			<OutputField FieldID="Value" Caption="Score" DataType="String" />
			<OutputField FieldID="StartDate" Caption="Start Date" DataType="Date" />
			<OutputField FieldID="EndDate" Caption="End Date" DataType="Date" />
		</OutputFields>
	</Output>

</DataListSpec>
